<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ | çŠ¬ã®é¼»ãƒ©ãƒ™ãƒªãƒ³ã‚°ç®¡ç†ãƒ„ãƒ¼ãƒ«</title>
	<style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

		.container {
			max-width: 1200px;
			margin: 0 auto;
			padding: 20px;
			padding-top: 80px; /* ãƒ˜ãƒƒãƒ€ãƒ¼åˆ†ã®ä½™ç™½ */
		}
		.header {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
			padding: 20px;
			border-radius: 10px;
			margin-bottom: 20px;
			text-align: center;
		}
		.header h1 {
			font-size: 2.5em;
			margin-bottom: 10px;
		}
		.header p {
			font-size: 1.1em;
			opacity: 0.9;
		}
        .auto-split-section {
			margin: 40px 0 0 0;
			padding: 24px;
			border: 2px solid #4CAF50;
			border-radius: 8px;
			background-color: #f9f9f9;
			max-width: 500px;
			margin-left: auto;
			margin-right: auto;
		}
		.percentage-inputs {
			display: flex;
			gap: 15px;
			margin-bottom: 15px;
			flex-wrap: wrap;
		}
		.input-group {
			display: flex;
			flex-direction: column;
			min-width: 100px;
		}
		.input-group label {
			font-weight: bold;
			margin-bottom: 5px;
			color: #333;
		}
		.input-group input {
			padding: 8px;
			border: 1px solid #ddd;
			border-radius: 4px;
			font-size: 14px;
		}
		.auto-split-buttons {
			display: flex;
			gap: 10px;
			flex-wrap: wrap;
		}
		.preview-button, .auto-split-button {
			padding: 10px 20px;
			border: none;
			border-radius: 5px;
			cursor: pointer;
			font-size: 14px;
			font-weight: bold;
		}
		.preview-button {
			background-color: #2196F3;
			color: white;
		}
		.preview-button:hover {
			background-color: #1976D2;
		}
		.auto-split-button {
			background-color: #4CAF50;
			color: white;
		}
		.auto-split-button:hover {
			background-color: #45a049;
		}
		.auto-split-button:disabled {
			background-color: #cccccc;
			cursor: not-allowed;
		}
		.split-preview, .split-result {
			margin-top: 15px;
			padding: 15px;
			border-radius: 5px;
			background-color: white;
			border: 1px solid #ddd;
		}
		.split-preview {
			border-left: 4px solid #2196F3;
		}
		.split-result {
			border-left: 4px solid #4CAF50;
		}
		.preview-stats {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
			gap: 10px;
			margin-top: 10px;
		}
		.stat-item {
			text-align: center;
			padding: 10px;
			background-color: #f5f5f5;
			border-radius: 4px;
		}
		.stat-value {
			font-size: 18px;
			font-weight: bold;
			color: #333;
		}
		.stat-label {
			font-size: 12px;
			color: #666;
			margin-top: 5px;
		}
	</style>
</head>
<body>
	{% include 'header.html' with context %}
	<div class="container" style="padding-top:80px;">
		<div class="header">
			<h1>ğŸ“ ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</h1>
			<p>ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚„è‡ªå‹•åˆ†å‰²ã‚’è¡Œã†ç”»é¢ã§ã™</p>
		</div>
		<div class="auto-split-section">
			<h2 style="text-align:center; margin-bottom:24px;">ğŸ¯ è‡ªå‹•ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆåˆ†å‰²</h2>
			<div class="auto-split-controls">
				<div class="percentage-inputs">
					<div class="input-group">
						<label for="trainPercent">Train (%)</label>
						<input type="number" id="trainPercent" value="80" min="0" max="100" step="0.1">
					</div>
					<div class="input-group">
						<label for="valPercent">Val (%)</label>
						<input type="number" id="valPercent" value="10" min="0" max="100" step="0.1">
					</div>
					<div class="input-group">
						<label for="testPercent">Test (%)</label>
						<input type="number" id="testPercent" value="10" min="0" max="100" step="0.1">
					</div>
				</div>
				<div class="auto-split-buttons">
					<button class="preview-button" onclick="previewAutoSplit()">ğŸ“Š ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
					<button class="auto-split-button" onclick="executeAutoSplit()">ğŸ¯ è‡ªå‹•åˆ†å‰²å®Ÿè¡Œ</button>
				</div>
			</div>
			<div id="splitPreview" class="split-preview" style="display: none;"></div>
			<div id="splitResult" class="split-result" style="display: none;"></div>
		</div>
		<div class="export-section" style="max-width:500px; margin:40px auto 0; background:#fff; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.07); padding:32px 24px;">
			<h2 style="text-align:center; margin-bottom:24px;">ğŸ“ ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</h2>
			<div class="export-buttons" style="display:grid; grid-template-columns:1fr; gap:16px;">
				<button class="dataset-export" style="padding:16px; font-size:16px; background:#17a2b8; color:#fff; border:none; border-radius:6px; cursor:pointer;" onclick="exportDataset()">ğŸ“ ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆZIPå‡ºåŠ›</button>
			</div>
			<div style="margin-top:24px; text-align:center; color:#888; font-size:13px;">â€»ã€Œã“ã®ç”»åƒã ã‘ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆZIPã€ã¯ãƒ©ãƒ™ãƒªãƒ³ã‚°ç”»é¢ã§ã®ã¿æœ‰åŠ¹ã§ã™</div>
		</div>
		<script>
		function exportDataset() {
			window.open('/api/export/dataset', '_blank');
		}
		function exportCurrentImageDataset() {
			alert('ã€Œã“ã®ç”»åƒã ã‘ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆZIPã€ã¯ãƒ©ãƒ™ãƒªãƒ³ã‚°ç”»é¢ã§ã”åˆ©ç”¨ãã ã•ã„ã€‚');
		}
		async function previewAutoSplit() {
			const trainPercent = parseFloat(document.getElementById('trainPercent').value);
			const valPercent = parseFloat(document.getElementById('valPercent').value);
			const testPercent = parseFloat(document.getElementById('testPercent').value);
			const total = trainPercent + valPercent + testPercent;
			if (Math.abs(total - 100) > 0.01) {
				alert(`å‰²åˆã®åˆè¨ˆãŒ100%ã«ãªã‚Šã¾ã›ã‚“: ${total}%`);
				return;
			}
			if (trainPercent < 0 || valPercent < 0 || testPercent < 0) {
				alert('å‰²åˆã¯0ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„');
				return;
			}
			const requestData = {
				train_percent: trainPercent,
				val_percent: valPercent,
				test_percent: testPercent,
				preview_only: true
			};
			const button = document.querySelector('.preview-button');
			const originalText = button.textContent;
			button.textContent = 'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸­...';
			button.disabled = true;
			try {
				const response = await fetch('/api/auto-split', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify(requestData)
				});
				const result = await response.json();
				if (response.ok) {
					displayPreviewResult(result);
				} else {
					alert(result.error || 'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
				}
			} catch (error) {
				console.error('ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒ©ãƒ¼:', error);
				alert('ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
			} finally {
				button.textContent = originalText;
				button.disabled = false;
			}
		}
		function displayPreviewResult(result) {
			const previewDiv = document.getElementById('splitPreview');
			previewDiv.innerHTML = `
				<h4>ğŸ“Š åˆ†å‰²ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h4>
					<p>ã‚¯ãƒ©ã‚¹è¨­å®šæ¸ˆã¿ç”»åƒ: <strong>${result.total_images}æš</strong></p>
				<div class="preview-stats">
					<div class="stat-item">
						<div class="stat-value">${result.train_count}æš</div>
						<div class="stat-label">Train (${result.train_percent_actual}%)</div>
					</div>
					<div class="stat-item">
						<div class="stat-value">${result.val_count}æš</div>
						<div class="stat-label">Val (${result.val_percent_actual}%)</div>
					</div>
					<div class="stat-item">
						<div class="stat-value">${result.test_count}æš</div>
						<div class="stat-label">Test (${result.test_percent_actual}%)</div>
					</div>
				</div>
				<p style="margin-top: 15px; color: #666; font-size: 14px;">
					âš ï¸ å®Ÿè¡Œã™ã‚‹ã¨æ—¢å­˜ã®åˆ†å‰²è¨­å®šã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™
				</p>
			`;
			previewDiv.style.display = 'block';
			document.getElementById('splitResult').style.display = 'none';
		}
		async function executeAutoSplit() {
			const trainPercent = parseFloat(document.getElementById('trainPercent').value);
			const valPercent = parseFloat(document.getElementById('valPercent').value);
			const testPercent = parseFloat(document.getElementById('testPercent').value);
			const total = trainPercent + valPercent + testPercent;
			if (Math.abs(total - 100) > 0.01) {
				alert(`å‰²åˆã®åˆè¨ˆãŒ100%ã«ãªã‚Šã¾ã›ã‚“: ${total}%`);
				return;
			}
			if (trainPercent < 0 || valPercent < 0 || testPercent < 0) {
				alert('å‰²åˆã¯0ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„');
				return;
			}
			const requestData = {
				train_percent: trainPercent,
				val_percent: valPercent,
				test_percent: testPercent,
				overwrite_existing: true
			};
			const confirmMessage = `ã‚¯ãƒ©ã‚¹è¨­å®šæ¸ˆã¿ã®å…¨ã¦ã®ç”»åƒã‚’ä»¥ä¸‹ã®å‰²åˆã§åˆ†å‰²ã—ã¾ã™:\nTrain: ${trainPercent}%\nVal: ${valPercent}%\nTest: ${testPercent}%\n\næ—¢å­˜ã®åˆ†å‰²è¨­å®šã‚‚ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ`;
			if (!confirm(confirmMessage)) {
				return;
			}
			const button = document.querySelector('.auto-split-button');
			const originalText = button.textContent;
			button.textContent = 'åˆ†å‰²ä¸­...';
			button.disabled = true;
			try {
				const response = await fetch('/api/auto-split', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify(requestData)
				});
				const result = await response.json();
				if (response.ok) {
					displayExecuteResult(result);
				} else {
					alert(result.error || 'è‡ªå‹•åˆ†å‰²ã«å¤±æ•—ã—ã¾ã—ãŸ');
				}
			} catch (error) {
				console.error('è‡ªå‹•åˆ†å‰²ã‚¨ãƒ©ãƒ¼:', error);
				alert('è‡ªå‹•åˆ†å‰²ã«å¤±æ•—ã—ã¾ã—ãŸ');
			} finally {
				button.textContent = originalText;
				button.disabled = false;
			}
		}
		function displayExecuteResult(result) {
			const resultDiv = document.getElementById('splitResult');
			resultDiv.innerHTML = `
				<h4>âœ… è‡ªå‹•åˆ†å‰²å®Œäº†</h4>
				<p>${result.message}</p>
			`;
			resultDiv.style.display = 'block';
			document.getElementById('splitPreview').style.display = 'none';
		}
		</script>
	</div>
</body>
</html>
